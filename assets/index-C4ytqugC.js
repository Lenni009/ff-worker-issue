(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}})();const u={PNG:"image/png",JPEG:"image/jpeg",GIF:"image/gif"};function m(r){return new Promise((o,n)=>{const s=new Image;s.onload=()=>o(s),s.onerror=()=>n(new Error("objectURL(): objectURL is illegal")),s.src=r})}function f(r){return new Worker("/ff-worker-issue/assets/worker-WjL2vs95.js",{name:r==null?void 0:r.name})}async function d(r){return new Promise((o,n)=>{const s=new f;s.postMessage(r,[r.buffer]),s.onmessage=({data:e})=>{const t=new Blob([e.buffer],{type:r.config.type});o(t)},s.onerror=e=>{n(e)}})}async function p(r,o={}){o.type??(o.type=u.JPEG),o.quality??(o.quality=.92);const n=URL.createObjectURL(r),{width:s,height:e}=await m(n);URL.revokeObjectURL(n);const t={originalType:r.type,...o},l={buffer:await r.arrayBuffer(),img:{width:s,height:e},config:t};return await d(l)}const c=document.getElementById("file-upload");c==null||c.addEventListener("change",y);let a=0;async function g(r){const o=await p(r),n=new File([o],"compressed",{type:"image/jpeg"});return a++,console.log(a),n}async function y(){if(!(c instanceof HTMLInputElement)){console.error("input not found!");return}console.log("Starting compression...");const r=Array.from(c.files??[]);console.log(`The counter should reach ${r.length}`);const o=r.map(g),n=await Promise.all(o);console.log("finished!",n)}
