(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();const a={PNG:"image/png",JPEG:"image/jpeg",GIF:"image/gif"};function p(t){return new Promise((e,s)=>{const n=new Image;n.onload=()=>e(n),n.onerror=()=>s(new Error("objectURL(): objectURL is illegal")),n.src=t})}const m="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO29ubWVzc2FnZT1hc3luYyh7ZGF0YTpzfSk9Pntjb25zdCBlPXtidWZmZXI6YXdhaXQoYXdhaXQgbihzKSkuYXJyYXlCdWZmZXIoKX07cG9zdE1lc3NhZ2UoZSx7dHJhbnNmZXI6W2UuYnVmZmVyXX0pLGNsb3NlKCl9O2FzeW5jIGZ1bmN0aW9uIG4oe2ltZzp7d2lkdGg6cyxoZWlnaHQ6YX0sYnVmZmVyOm8sY29uZmlnOmV9KXtjb25zdCByPW5ldyBPZmZzY3JlZW5DYW52YXMocyxhKSx0PXIuZ2V0Q29udGV4dCgiMmQiKSxjPW5ldyBCbG9iKFtvXSx7dHlwZTplLm9yaWdpbmFsVHlwZX0pLGY9YXdhaXQgY3JlYXRlSW1hZ2VCaXRtYXAoYyk7cmV0dXJuIHQ9PW51bGx8fHQuZHJhd0ltYWdlKGYsMCwwKSxhd2FpdCByLmNvbnZlcnRUb0Jsb2IoZSl9fSkoKTsK",b=t=>Uint8Array.from(atob(t),e=>e.charCodeAt(0)),l=typeof window<"u"&&window.Blob&&new Blob([b(m)],{type:"text/javascript;charset=utf-8"});function w(t){let e;try{if(e=l&&(window.URL||window.webkitURL).createObjectURL(l),!e)throw"";const s=new Worker(e,{name:t==null?void 0:t.name});return s.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),s}catch{return new Worker("data:text/javascript;base64,"+m,{name:t==null?void 0:t.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}async function y(t){return new Promise((e,s)=>{const n=new w;n.postMessage(t,[t.buffer]),n.onmessage=({data:r})=>{const o=new Blob([r.buffer],{type:t.config.type});e(o)},n.onerror=r=>{s(r)}})}async function g(t,e={}){e.type??(e.type=a.JPEG),e.quality??(e.quality=.92);const s=URL.createObjectURL(t),{width:n,height:r}=await p(s);URL.revokeObjectURL(s);const o={originalType:t.type,...e},f={buffer:await t.arrayBuffer(),img:{width:n,height:r},config:o};return await y(f)}const i=document.getElementById("file-upload");i==null||i.addEventListener("change",async()=>{if(!(i instanceof HTMLInputElement)){console.error("input is null");return}console.log("starting...");const t=Array.from(i.files??[]);let e=0;const n=t.map(c=>({id:e++,file:c})).map(c=>u(c.file)),o=(await Promise.all(n)).map(c=>new File([c],"fileName",{type:"image/jpeg"}));console.log("done",o)});const d=5e5;async function u(t,e=1){if(t.size<d)return t;console.log(e);const s=await g(t,{quality:e,type:a.JPEG}),n=e-.01;if(s.size>d)return await u(t,n);const o=t.name.split(".").slice(0,-1).join(".")+"-min.jpg";return new File([s],o,{type:a.JPEG})}
